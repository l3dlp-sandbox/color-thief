!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).ColorThief=e()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},t.apply(null,arguments)}var e=function(t,e){return t<e?-1:t>e?1:0},r=function(t){return t.reduce(function(t,e){return t+e},0)},n=/*#__PURE__*/function(){function t(t){this.colors=t}var e=t.prototype;return e.palette=function(){return this.colors},e.map=function(t){return t},t}(),o=function(){function t(t,e,r){return(t<<10)+(e<<5)+r}function o(t){var e=[],r=!1;function n(){e.sort(t),r=!0}return{push:function(t){e.push(t),r=!1},peek:function(t){return r||n(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return r||n(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return r||n(),e}}}function a(t,e,r,n,o,a,i){var u=this;u.r1=t,u.r2=e,u.g1=r,u.g2=n,u.b1=o,u.b2=a,u.histo=i}function i(){this.vboxes=new o(function(t,r){return e(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function u(e,r){if(r.count()){var n=r.r2-r.r1+1,o=r.g2-r.g1+1,a=Math.max.apply(null,[n,o,r.b2-r.b1+1]);if(1==r.count())return[r.copy()];var i,u,h,l,f=0,c=[],s=[];if(a==n)for(i=r.r1;i<=r.r2;i++){for(l=0,u=r.g1;u<=r.g2;u++)for(h=r.b1;h<=r.b2;h++)l+=e[t(i,u,h)]||0;c[i]=f+=l}else if(a==o)for(i=r.g1;i<=r.g2;i++){for(l=0,u=r.r1;u<=r.r2;u++)for(h=r.b1;h<=r.b2;h++)l+=e[t(u,i,h)]||0;c[i]=f+=l}else for(i=r.b1;i<=r.b2;i++){for(l=0,u=r.r1;u<=r.r2;u++)for(h=r.g1;h<=r.g2;h++)l+=e[t(u,h,i)]||0;c[i]=f+=l}return c.forEach(function(t,e){s[e]=f-t}),function(t){var e,n,o,a,u,h=t+"1",l=t+"2",g=0;for(i=r[h];i<=r[l];i++)if(c[i]>f/2){for(o=r.copy(),a=r.copy(),u=(e=i-r[h])<=(n=r[l]-i)?Math.min(r[l]-1,~~(i+n/2)):Math.max(r[h],~~(i-1-e/2));!c[u];)u++;for(g=s[u];!g&&c[u-1];)g=s[--u];return o[l]=u,a[h]=o[l]+1,[o,a]}}(a==n?"r":a==o?"g":"b")}}return a.prototype={volume:function(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var r=this,n=r.histo;if(!r._count_set||e){var o,a,i,u=0;for(o=r.r1;o<=r.r2;o++)for(a=r.g1;a<=r.g2;a++)for(i=r.b1;i<=r.b2;i++)u+=n[t(o,a,i)]||0;r._count=u,r._count_set=!0}return r._count},copy:function(){var t=this;return new a(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var r=this,n=r.histo;if(!r._avg||e){var o,a,i,u,h=0,l=0,f=0,c=0;if(r.r1===r.r2&&r.g1===r.g2&&r.b1===r.b2)r._avg=[r.r1<<3,r.g1<<3,r.b1<<3];else{for(a=r.r1;a<=r.r2;a++)for(i=r.g1;i<=r.g2;i++)for(u=r.b1;u<=r.b2;u++)h+=o=n[t(a,i,u)]||0,l+=o*(a+.5)*8,f+=o*(i+.5)*8,c+=o*(u+.5)*8;r._avg=h?[~~(l/h),~~(f/h),~~(c/h)]:[~~(8*(r.r1+r.r2+1)/2),~~(8*(r.g1+r.g2+1)/2),~~(8*(r.b1+r.b2+1)/2)]}}return r._avg},contains:function(t){var e=this,r=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,r>=e.r1&&r<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},i.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,r=0;r<e.size();r++)if(e.peek(r).vbox.contains(t))return e.peek(r).color;return this.nearest(t)},nearest:function(t){for(var e,r,n,o=this.vboxes,a=0;a<o.size();a++)((r=Math.sqrt(Math.pow(t[0]-o.peek(a).color[0],2)+Math.pow(t[1]-o.peek(a).color[1],2)+Math.pow(t[2]-o.peek(a).color[2],2)))<e||void 0===e)&&(e=r,n=o.peek(a).color);return n},forcebw:function(){var t=this.vboxes;t.sort(function(t,n){return e(r(t.color),r(n.color))});var n=t[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(t[0].color=[0,0,0]);var o=t.length-1,a=t[o].color;a[0]>251&&a[1]>251&&a[2]>251&&(t[o].color=[255,255,255])}},{quantize:function(r,h){if(!Number.isInteger(h)||h<1||h>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!r.length||h<2||h>256)return!1;if(!r.length||h<2||h>256)return!1;for(var l=[],f=new Set,c=0;c<r.length;c++){var s=r[c],g=s.join(",");f.has(g)||(f.add(g),l.push(s))}if(l.length<=h)return new n(l);var p=function(e){var r,n=new Array(32768);return e.forEach(function(e){r=t(e[0]>>3,e[1]>>3,e[2]>>3),n[r]=(n[r]||0)+1}),n}(r);p.forEach(function(){});var v=function(t,e){var r,n,o,i=1e6,u=0,h=1e6,l=0,f=1e6,c=0;return t.forEach(function(t){(r=t[0]>>3)<i?i=r:r>u&&(u=r),(n=t[1]>>3)<h?h=n:n>l&&(l=n),(o=t[2]>>3)<f?f=o:o>c&&(c=o)}),new a(i,u,h,l,f,c,e)}(r,p),d=new o(function(t,r){return e(t.count(),r.count())});function m(t,e){for(var r,n=t.size(),o=0;o<1e3;){if(n>=e)return;if(o++>1e3)return;if((r=t.pop()).count()){var a=u(p,r),i=a[0],h=a[1];if(!i)return;t.push(i),h&&(t.push(h),n++)}else t.push(r),o++}}d.push(v),m(d,.75*h);for(var b=new o(function(t,r){return e(t.count()*t.volume(),r.count()*r.volume())});d.size();)b.push(d.pop());m(b,h);for(var w=new i;b.size();)w.push(b.pop());return w}}}().quantize,a=function(t,e,r,n){for(var o,a,i,u,h,l=n||{},f=l.ignoreWhite,c=void 0===f||f,s=l.whiteThreshold,g=void 0===s?250:s,p=l.alphaThreshold,v=void 0===p?125:p,d=l.minSaturation,m=void 0===d?0:d,b=t,w=[],y=0;y<e;y+=r)if(a=b[0+(o=4*y)],i=b[o+1],u=b[o+2],!(void 0!==(h=b[o+3])&&h<v||c&&a>g&&i>g&&u>g)){if(m>0){var x=Math.max(a,i,u);if(0===x||(x-Math.min(a,i,u))/x<m)continue}w.push([a,i,u])}return w},i=function(t){var e=t.colorCount,r=t.quality;if(void 0!==e&&Number.isInteger(e)){if(1===e)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");e=Math.max(e,2),e=Math.min(e,20)}else e=10;return(void 0===r||!Number.isInteger(r)||r<1)&&(r=10),{colorCount:e,quality:r,ignoreWhite:void 0===t.ignoreWhite||!!t.ignoreWhite,whiteThreshold:"number"==typeof t.whiteThreshold?t.whiteThreshold:250,alphaThreshold:"number"==typeof t.alphaThreshold?t.alphaThreshold:125,minSaturation:"number"==typeof t.minSaturation?Math.max(0,Math.min(1,t.minSaturation)):0}},u=function(){};return u.prototype.getColor=function(e,r){if("object"==typeof r&&null!==r){var n=this.getPalette(e,t({colorCount:5},r));return null===n?null:n[0]}var o=this.getPalette(e,5,r);return null===o?null:o[0]},u.prototype.getPalette=function(e,r,n){var u,h,l,f={ignoreWhite:(u=i("object"==typeof r&&null!==r?{colorCount:r.colorCount,quality:r.quality,ignoreWhite:r.ignoreWhite,whiteThreshold:r.whiteThreshold,alphaThreshold:r.alphaThreshold,minSaturation:r.minSaturation}:{colorCount:r,quality:n})).ignoreWhite,whiteThreshold:u.whiteThreshold,alphaThreshold:u.alphaThreshold,minSaturation:u.minSaturation};if(!e)throw new Error("sourceImage is required");if(e instanceof HTMLImageElement){if(!e.complete)throw new Error('Image has not finished loading. Wait for the "load" event before calling getColor/getPalette.');if(!e.naturalWidth)throw new Error("Image has no dimensions. It may not have loaded successfully.")}try{var c=function(t){if(t instanceof HTMLImageElement){var e=document.createElement("canvas"),r=e.getContext("2d"),n=e.width=t.naturalWidth,o=e.height=t.naturalHeight;return r.drawImage(t,0,0,n,o),{imageData:r.getImageData(0,0,n,o),pixelCount:n*o}}if(t instanceof HTMLCanvasElement){var a=t.getContext("2d"),i=t.width,u=t.height;return{imageData:a.getImageData(0,0,i,u),pixelCount:i*u}}if("undefined"!=typeof ImageData&&t instanceof ImageData)return{imageData:t,pixelCount:t.width*t.height};if("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var h=document.createElement("canvas"),l=h.getContext("2d");return h.width=t.width,h.height=t.height,l.drawImage(t,0,0),{imageData:l.getImageData(0,0,t.width,t.height),pixelCount:t.width*t.height}}throw new Error("Unsupported source type. Expected HTMLImageElement, HTMLCanvasElement, ImageData, or ImageBitmap.")}(e);h=c.imageData,l=c.pixelCount}catch(t){if("SecurityError"===t.name)throw new Error('Image is tainted by cross-origin data. Add crossorigin="anonymous" to the <img> tag and ensure the server sends appropriate CORS headers.',{cause:t});throw t}var s=a(h.data,l,u.quality,f);0===s.length&&(s=a(h.data,l,u.quality,t({},f,{ignoreWhite:!1}))),0===s.length&&(s=a(h.data,l,u.quality,t({},f,{ignoreWhite:!1,alphaThreshold:0})));var g=o(s,u.colorCount),p=g?g.palette():null;if(p)return p;var v=function(t,e,r){for(var n=t,o=0,a=0,i=0,u=0,h=0;h<e;h+=r){var l=4*h;o+=n[l],a+=n[l+1],i+=n[l+2],u++}return 0===u?null:[Math.round(o/u),Math.round(a/u),Math.round(i/u)]}(h.data,l,u.quality);return v?[v]:null},u.prototype.getColorFromUrl=function(t,e,r){var n=this,o=document.createElement("img");o.addEventListener("load",function(){var a=n.getPalette(o,5,r);e(a?a[0]:null,t)}),o.src=t},u.prototype.getImageData=function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){if(200==this.status){for(var t=new Uint8Array(this.response),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);var o=r.join(""),a=window.btoa(o);e("data:image/png;base64,"+a)}},r.send()},u.prototype.getColorAsync=function(t,e,r){var n=this;this.getImageData(t,function(t){var o=document.createElement("img");o.addEventListener("load",function(){var t=n.getPalette(o,5,r);e(t?t[0]:null,this)}),o.src=t})},u});
