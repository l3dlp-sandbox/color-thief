function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},t.apply(null,arguments)}var e=function(t,e){return t<e?-1:t>e?1:0},n=function(t){return t.reduce(function(t,e){return t+e},0)},o=/*#__PURE__*/function(){function t(t){this.colors=t}var e=t.prototype;return e.palette=function(){return this.colors},e.map=function(t){return t},t}(),r=function(){function t(t,e,n){return(t<<10)+(e<<5)+n}function r(t){var e=[],n=!1;function o(){e.sort(t),n=!0}return{push:function(t){e.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return n||o(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return n||o(),e}}}function a(t,e,n,o,r,a,i){var u=this;u.r1=t,u.r2=e,u.g1=n,u.g2=o,u.b1=r,u.b2=a,u.histo=i}function i(){this.vboxes=new r(function(t,n){return e(t.vbox.count()*t.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function u(e,n){if(n.count()){var o=n.r2-n.r1+1,r=n.g2-n.g1+1,a=Math.max.apply(null,[o,r,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var i,u,l,h,c=0,s=[],f=[];if(a==o)for(i=n.r1;i<=n.r2;i++){for(h=0,u=n.g1;u<=n.g2;u++)for(l=n.b1;l<=n.b2;l++)h+=e[t(i,u,l)]||0;s[i]=c+=h}else if(a==r)for(i=n.g1;i<=n.g2;i++){for(h=0,u=n.r1;u<=n.r2;u++)for(l=n.b1;l<=n.b2;l++)h+=e[t(u,i,l)]||0;s[i]=c+=h}else for(i=n.b1;i<=n.b2;i++){for(h=0,u=n.r1;u<=n.r2;u++)for(l=n.g1;l<=n.g2;l++)h+=e[t(u,l,i)]||0;s[i]=c+=h}return s.forEach(function(t,e){f[e]=c-t}),function(t){var e,o,r,a,u,l=t+"1",h=t+"2",g=0;for(i=n[l];i<=n[h];i++)if(s[i]>c/2){for(r=n.copy(),a=n.copy(),u=(e=i-n[l])<=(o=n[h]-i)?Math.min(n[h]-1,~~(i+o/2)):Math.max(n[l],~~(i-1-e/2));!s[u];)u++;for(g=f[u];!g&&s[u-1];)g=f[--u];return r[h]=u,a[l]=r[h]+1,[r,a]}}(a==o?"r":a==r?"g":"b")}}return a.prototype={volume:function(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var n=this,o=n.histo;if(!n._count_set||e){var r,a,i,u=0;for(r=n.r1;r<=n.r2;r++)for(a=n.g1;a<=n.g2;a++)for(i=n.b1;i<=n.b2;i++)u+=o[t(r,a,i)]||0;n._count=u,n._count_set=!0}return n._count},copy:function(){var t=this;return new a(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var n=this,o=n.histo;if(!n._avg||e){var r,a,i,u,l=0,h=0,c=0,s=0;if(n.r1===n.r2&&n.g1===n.g2&&n.b1===n.b2)n._avg=[n.r1<<3,n.g1<<3,n.b1<<3];else{for(a=n.r1;a<=n.r2;a++)for(i=n.g1;i<=n.g2;i++)for(u=n.b1;u<=n.b2;u++)l+=r=o[t(a,i,u)]||0,h+=r*(a+.5)*8,c+=r*(i+.5)*8,s+=r*(u+.5)*8;n._avg=l?[~~(h/l),~~(c/l),~~(s/l)]:[~~(8*(n.r1+n.r2+1)/2),~~(8*(n.g1+n.g2+1)/2),~~(8*(n.b1+n.b2+1)/2)]}}return n._avg},contains:function(t){var e=this,n=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,n>=e.r1&&n<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},i.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,n=0;n<e.size();n++)if(e.peek(n).vbox.contains(t))return e.peek(n).color;return this.nearest(t)},nearest:function(t){for(var e,n,o,r=this.vboxes,a=0;a<r.size();a++)((n=Math.sqrt(Math.pow(t[0]-r.peek(a).color[0],2)+Math.pow(t[1]-r.peek(a).color[1],2)+Math.pow(t[2]-r.peek(a).color[2],2)))<e||void 0===e)&&(e=n,o=r.peek(a).color);return o},forcebw:function(){var t=this.vboxes;t.sort(function(t,o){return e(n(t.color),n(o.color))});var o=t[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(t[0].color=[0,0,0]);var r=t.length-1,a=t[r].color;a[0]>251&&a[1]>251&&a[2]>251&&(t[r].color=[255,255,255])}},{quantize:function(n,l){if(!Number.isInteger(l)||l<1||l>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!n.length||l<2||l>256)return!1;if(!n.length||l<2||l>256)return!1;for(var h=[],c=new Set,s=0;s<n.length;s++){var f=n[s],g=f.join(",");c.has(g)||(c.add(g),h.push(f))}if(h.length<=l)return new o(h);var p=function(e){var n,o=new Array(32768);return e.forEach(function(e){n=t(e[0]>>3,e[1]>>3,e[2]>>3),o[n]=(o[n]||0)+1}),o}(n);p.forEach(function(){});var m=function(t,e){var n,o,r,i=1e6,u=0,l=1e6,h=0,c=1e6,s=0;return t.forEach(function(t){(n=t[0]>>3)<i?i=n:n>u&&(u=n),(o=t[1]>>3)<l?l=o:o>h&&(h=o),(r=t[2]>>3)<c?c=r:r>s&&(s=r)}),new a(i,u,l,h,c,s,e)}(n,p),d=new r(function(t,n){return e(t.count(),n.count())});function v(t,e){for(var n,o=t.size(),r=0;r<1e3;){if(o>=e)return;if(r++>1e3)return;if((n=t.pop()).count()){var a=u(p,n),i=a[0],l=a[1];if(!i)return;t.push(i),l&&(t.push(l),o++)}else t.push(n),r++}}d.push(m),v(d,.75*l);for(var b=new r(function(t,n){return e(t.count()*t.volume(),n.count()*n.volume())});d.size();)b.push(d.pop());v(b,l);for(var w=new i;b.size();)w.push(b.pop());return w}}}().quantize,a=function(t,e,n,o){const{ignoreWhite:r=!0,whiteThreshold:a=250,alphaThreshold:i=125,minSaturation:u=0}=o||{},l=t,h=[];for(let t,o,c,s,f,g=0;g<e;g+=n)if(t=4*g,o=l[t+0],c=l[t+1],s=l[t+2],f=l[t+3],!(void 0!==f&&f<i||r&&o>a&&c>a&&s>a)){if(u>0){const t=Math.max(o,c,s);if(0===t||(t-Math.min(o,c,s))/t<u)continue}h.push([o,c,s])}return h},i=function(){};i.prototype.getColor=function(e,n){if("object"==typeof n&&null!==n){const o=this.getPalette(e,t({colorCount:5},n));return null===o?null:o[0]}const o=this.getPalette(e,5,n);return null===o?null:o[0]},i.prototype.getPalette=function(e,n,o){let i;i=function(t){let{colorCount:e,quality:n}=t;if(void 0!==e&&Number.isInteger(e)){if(1===e)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");e=Math.max(e,2),e=Math.min(e,20)}else e=10;return(void 0===n||!Number.isInteger(n)||n<1)&&(n=10),{colorCount:e,quality:n,ignoreWhite:void 0===t.ignoreWhite||!!t.ignoreWhite,whiteThreshold:"number"==typeof t.whiteThreshold?t.whiteThreshold:250,alphaThreshold:"number"==typeof t.alphaThreshold?t.alphaThreshold:125,minSaturation:"number"==typeof t.minSaturation?Math.max(0,Math.min(1,t.minSaturation)):0}}("object"==typeof n&&null!==n?{colorCount:n.colorCount,quality:n.quality,ignoreWhite:n.ignoreWhite,whiteThreshold:n.whiteThreshold,alphaThreshold:n.alphaThreshold,minSaturation:n.minSaturation}:{colorCount:n,quality:o});const u={ignoreWhite:i.ignoreWhite,whiteThreshold:i.whiteThreshold,alphaThreshold:i.alphaThreshold,minSaturation:i.minSaturation};if(!e)throw new Error("sourceImage is required");if(e instanceof HTMLImageElement){if(!e.complete)throw new Error('Image has not finished loading. Wait for the "load" event before calling getColor/getPalette.');if(!e.naturalWidth)throw new Error("Image has no dimensions. It may not have loaded successfully.")}let l,h;try{const t=function(t){if(t instanceof HTMLImageElement){const e=document.createElement("canvas"),n=e.getContext("2d"),o=e.width=t.naturalWidth,r=e.height=t.naturalHeight;return n.drawImage(t,0,0,o,r),{imageData:n.getImageData(0,0,o,r),pixelCount:o*r}}if(t instanceof HTMLCanvasElement){const e=t.getContext("2d"),n=t.width,o=t.height;return{imageData:e.getImageData(0,0,n,o),pixelCount:n*o}}if("undefined"!=typeof ImageData&&t instanceof ImageData)return{imageData:t,pixelCount:t.width*t.height};if("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),{imageData:n.getImageData(0,0,t.width,t.height),pixelCount:t.width*t.height}}throw new Error("Unsupported source type. Expected HTMLImageElement, HTMLCanvasElement, ImageData, or ImageBitmap.")}(e);l=t.imageData,h=t.pixelCount}catch(t){if("SecurityError"===t.name)throw new Error('Image is tainted by cross-origin data. Add crossorigin="anonymous" to the <img> tag and ensure the server sends appropriate CORS headers.',{cause:t});throw t}let c=a(l.data,h,i.quality,u);0===c.length&&(c=a(l.data,h,i.quality,t({},u,{ignoreWhite:!1}))),0===c.length&&(c=a(l.data,h,i.quality,t({},u,{ignoreWhite:!1,alphaThreshold:0})));const s=r(c,i.colorCount),f=s?s.palette():null;if(f)return f;const g=function(t,e,n){const o=t;let r=0,a=0,i=0,u=0;for(let t=0;t<e;t+=n){const e=4*t;r+=o[e],a+=o[e+1],i+=o[e+2],u++}return 0===u?null:[Math.round(r/u),Math.round(a/u),Math.round(i/u)]}(l.data,h,i.quality);return g?[g]:null},i.prototype.getColorFromUrl=function(t,e,n){const o=document.createElement("img");o.addEventListener("load",()=>{const r=this.getPalette(o,5,n);e(r?r[0]:null,t)}),o.src=t},i.prototype.getImageData=function(t,e){let n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){if(200==this.status){let t=new Uint8Array(this.response),n=new Array(t.length);for(let e=0;e<t.length;e++)n[e]=String.fromCharCode(t[e]);let o=n.join(""),r=window.btoa(o);e("data:image/png;base64,"+r)}},n.send()},i.prototype.getColorAsync=function(t,e,n){const o=this;this.getImageData(t,function(t){const r=document.createElement("img");r.addEventListener("load",function(){const t=o.getPalette(r,5,n);e(t?t[0]:null,this)}),r.src=t})};export{i as default};
