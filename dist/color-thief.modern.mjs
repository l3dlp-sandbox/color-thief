var t=function(t,n){return t<n?-1:t>n?1:0},n=function(t){return t.reduce(function(t,n){return t+n},0)},r=/*#__PURE__*/function(){function t(t){this.colors=t}var n=t.prototype;return n.palette=function(){return this.colors},n.map=function(t){return t},t}(),e=function(){function e(t,n,r){return(t<<10)+(n<<5)+r}function o(t){var n=[],r=!1;function e(){n.sort(t),r=!0}return{push:function(t){n.push(t),r=!1},peek:function(t){return r||e(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return r||e(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return r||e(),n}}}function i(t,n,r,e,o,i,u){var a=this;a.r1=t,a.r2=n,a.g1=r,a.g2=e,a.b1=o,a.b2=i,a.histo=u}function u(){this.vboxes=new o(function(n,r){return t(n.vbox.count()*n.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function a(t,n){if(n.count()){var r=n.r2-n.r1+1,o=n.g2-n.g1+1,i=Math.max.apply(null,[r,o,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var u,a,c,s,f=0,l=[],h=[];if(i==r)for(u=n.r1;u<=n.r2;u++){for(s=0,a=n.g1;a<=n.g2;a++)for(c=n.b1;c<=n.b2;c++)s+=t[e(u,a,c)]||0;l[u]=f+=s}else if(i==o)for(u=n.g1;u<=n.g2;u++){for(s=0,a=n.r1;a<=n.r2;a++)for(c=n.b1;c<=n.b2;c++)s+=t[e(a,u,c)]||0;l[u]=f+=s}else for(u=n.b1;u<=n.b2;u++){for(s=0,a=n.r1;a<=n.r2;a++)for(c=n.g1;c<=n.g2;c++)s+=t[e(a,c,u)]||0;l[u]=f+=s}return l.forEach(function(t,n){h[n]=f-t}),function(t){var r,e,o,i,a,c=t+"1",s=t+"2",g=0;for(u=n[c];u<=n[s];u++)if(l[u]>f/2){for(o=n.copy(),i=n.copy(),a=(r=u-n[c])<=(e=n[s]-u)?Math.min(n[s]-1,~~(u+e/2)):Math.max(n[c],~~(u-1-r/2));!l[a];)a++;for(g=h[a];!g&&l[a-1];)g=h[--a];return o[s]=a,i[c]=o[s]+1,[o,i]}}(i==r?"r":i==o?"g":"b")}}return i.prototype={volume:function(t){var n=this;return n._volume&&!t||(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(t){var n=this,r=n.histo;if(!n._count_set||t){var o,i,u,a=0;for(o=n.r1;o<=n.r2;o++)for(i=n.g1;i<=n.g2;i++)for(u=n.b1;u<=n.b2;u++)a+=r[e(o,i,u)]||0;n._count=a,n._count_set=!0}return n._count},copy:function(){var t=this;return new i(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var n=this,r=n.histo;if(!n._avg||t){var o,i,u,a,c=0,s=0,f=0,l=0;if(n.r1===n.r2&&n.g1===n.g2&&n.b1===n.b2)n._avg=[n.r1<<3,n.g1<<3,n.b1<<3];else{for(i=n.r1;i<=n.r2;i++)for(u=n.g1;u<=n.g2;u++)for(a=n.b1;a<=n.b2;a++)c+=o=r[e(i,u,a)]||0,s+=o*(i+.5)*8,f+=o*(u+.5)*8,l+=o*(a+.5)*8;n._avg=c?[~~(s/c),~~(f/c),~~(l/c)]:[~~(8*(n.r1+n.r2+1)/2),~~(8*(n.g1+n.g2+1)/2),~~(8*(n.b1+n.b2+1)/2)]}}return n._avg},contains:function(t){var n=this,r=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,r>=n.r1&&r<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,r=0;r<n.size();r++)if(n.peek(r).vbox.contains(t))return n.peek(r).color;return this.nearest(t)},nearest:function(t){for(var n,r,e,o=this.vboxes,i=0;i<o.size();i++)((r=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)))<n||void 0===n)&&(n=r,e=o.peek(i).color);return e},forcebw:function(){var r=this.vboxes;r.sort(function(r,e){return t(n(r.color),n(e.color))});var e=r[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(r[0].color=[0,0,0]);var o=r.length-1,i=r[o].color;i[0]>251&&i[1]>251&&i[2]>251&&(r[o].color=[255,255,255])}},{quantize:function(n,c){if(!Number.isInteger(c)||c<1||c>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!n.length||c<2||c>256)return!1;if(!n.length||c<2||c>256)return!1;for(var s=[],f=new Set,l=0;l<n.length;l++){var h=n[l],g=h.join(",");f.has(g)||(f.add(g),s.push(h))}if(s.length<=c)return new r(s);var v=function(t){var n,r=new Array(32768);return t.forEach(function(t){n=e(t[0]>>3,t[1]>>3,t[2]>>3),r[n]=(r[n]||0)+1}),r}(n);v.forEach(function(){});var p=function(t,n){var r,e,o,u=1e6,a=0,c=1e6,s=0,f=1e6,l=0;return t.forEach(function(t){(r=t[0]>>3)<u?u=r:r>a&&(a=r),(e=t[1]>>3)<c?c=e:e>s&&(s=e),(o=t[2]>>3)<f?f=o:o>l&&(l=o)}),new i(u,a,c,s,f,l,n)}(n,v),b=new o(function(n,r){return t(n.count(),r.count())});function m(t,n){for(var r,e=t.size(),o=0;o<1e3;){if(e>=n)return;if(o++>1e3)return;if((r=t.pop()).count()){var i=a(v,r),u=i[0],c=i[1];if(!u)return;t.push(u),c&&(t.push(c),e++)}else t.push(r),o++}}b.push(p),m(b,.75*c);for(var d=new o(function(n,r){return t(n.count()*n.volume(),r.count()*r.volume())});b.size();)d.push(b.pop());m(d,c);for(var w=new u;d.size();)w.push(d.pop());return w}}}().quantize,o=function(t,n,r,{filterWhite:e=!0,filterTransparent:o=!0}={}){const i=t,u=[];for(let t,a,c,s,f,l=0;l<n;l+=r)t=4*l,a=i[t+0],c=i[t+1],s=i[t+2],f=i[t+3],o&&void 0!==f&&f<125||e&&a>250&&c>250&&s>250||u.push([a,c,s]);return u};const u=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};u.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var a=function(){};a.prototype.getColor=function(t,n=10){const r=this.getPalette(t,5,n);return null===r?null:r[0]},a.prototype.getPalette=function(t,n,r){const i=function(t){let{colorCount:n,quality:r}=t;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return(void 0===r||!Number.isInteger(r)||r<1)&&(r=10),{colorCount:n,quality:r}}({colorCount:n,quality:r}),a=new u(t),c=a.getImageData(),s=a.width*a.height;let f=o(c.data,s,i.quality);0===f.length&&(f=o(c.data,s,i.quality,{filterWhite:!1})),0===f.length&&(f=o(c.data,s,i.quality,{filterWhite:!1,filterTransparent:!1}));const l=e(f,i.colorCount);return l?l.palette():null},a.prototype.getColorFromUrl=function(t,n,r){const e=document.createElement("img");e.addEventListener("load",()=>{const o=this.getPalette(e,5,r);n(o[0],t)}),e.src=t},a.prototype.getImageData=function(t,n){let r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){if(200==this.status){let t=new Uint8Array(this.response);i=t.length;let r=new Array(i);for(let n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);let e=r.join(""),o=window.btoa(e);n("data:image/png;base64,"+o)}},r.send()},a.prototype.getColorAsync=function(t,n,r){const e=this;this.getImageData(t,function(t){const o=document.createElement("img");o.addEventListener("load",function(){const t=e.getPalette(o,5,r);n(t[0],this)}),o.src=t})};export{a as default};
